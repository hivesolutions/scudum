#!/bin/bash
# -*- coding: utf-8 -*-

REFRESH=${REFRESH-0}
TARGET=${TARGET-/opt}
EXTRAS=${EXTRAS-$TARGET/scudum/scripts/build/extras}
CONFIG_DIR=${CONFIG_DIR-/etc/scudum}
INSTALLED_FILE=${INSTALLED_FILE-$CONFIG_DIR/INSTALLED}

FORMAT="%-20s"

set -e +h

source /etc/colors

mkdir -p $TARGET && cd $TARGET

if [ ! -e scudum ]; then
    git clone --quiet --depth 1 https://github.com/hivesolutions/scudum.git
    cd scudum
elif [ "$REFRESH" == "1" ]; then
    cd scudum && git pull --quiet
fi

installed=$(cat $INSTALLED_FILE)

for file in $EXTRAS/*; do
    base=$(basename $file)
    package=${base%.*}
    printf $FORMAT $package
    if [[ $installed == *$package* ]]; then
        echo -e $COLOR_GREEN"INSTALLED"$COLOR_RESET
    else
        echo -e $COLOR_RED"NOT INSTALLED"$COLOR_RESET
    fi
done
